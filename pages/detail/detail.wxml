<!--pages/detail/detail.wxml-->
<view class="container">
  <!-- 加载中 -->
  <view class="loading" wx:if="{{loading}}">
    <text>加载中...</text>
  </view>

  <!-- 作业详情 -->
  <view class="detail-container" wx:else>
    <!-- 标题和学科 -->
    <view class="detail-header">
      <view class="detail-title">{{homework.title}}</view>
      <view class="tag tag-subject">{{homework.subject}}</view>
    </view>

    <!-- 发布时间 -->
    <view class="detail-time">
      <text>发布时间：{{homework.createTime}}</text>
    </view>

    <!-- 作业内容 -->
    <view class="detail-content">
      <view class="content-label">作业内容：</view>
      <view class="content-text">{{homework.content}}</view>
    </view>

    <!-- 视频文件/链接 -->
    <view class="media-section" wx:if="{{homework.videoUrl}}">
      <view class="media-label">
        <text class="label-icon">🎬</text>
        视频
      </view>
      <!-- 如果是链接，显示链接卡片 -->
      <view class="link-card" wx:if="{{homework.isVideoLink || (homework.videoUrl && homework.videoUrl.indexOf('http') === 0)}}">
        <view class="link-info">
          <text class="link-url">{{homework.videoUrl}}</text>
        </view>
        <view class="link-actions">
          <view class="copy-link-btn" data-link="{{homework.videoUrl}}" bindtap="copyLink">
            <text class="copy-icon">📋</text>
            <text>复制链接</text>
          </view>
        </view>
      </view>
      <!-- 如果是文件，显示播放器 -->
      <view class="media-container" wx:else>
        <video id="homework-video"
               class="video-player"
               src="{{videoSrc}}"
               controls
               show-center-play-btn="{{true}}"
               binderror="onVideoError"
               wx:if="{{videoSrc && !videoError}}">
        </video>
        <view class="media-placeholder" wx:else>
          <view class="media-icon">📹</view>
          <button class="play-btn" bindtap="playVideo" wx:if="{{!videoError}}">
            点击播放视频
          </button>
          <text class="error-text" wx:else>视频加载失败</text>
        </view>
      </view>
    </view>

    <!-- 音频文件/链接 -->
    <view class="media-section" wx:if="{{homework.audioUrl}}">
      <view class="media-label">
        <text class="label-icon">🎵</text>
        音频
      </view>
      <!-- 如果是链接，显示链接卡片 -->
      <view class="link-card" wx:if="{{homework.isAudioLink || (homework.audioUrl && homework.audioUrl.indexOf('http') === 0)}}">
        <view class="link-info">
          <text class="link-url">{{homework.audioUrl}}</text>
        </view>
        <view class="link-actions">
          <view class="copy-link-btn" data-link="{{homework.audioUrl}}" bindtap="copyLink">
            <text class="copy-icon">📋</text>
            <text>复制链接</text>
          </view>
        </view>
      </view>
      <!-- 如果是文件，显示播放器 -->
      <view class="media-container" wx:else>
        <audio id="homework-audio"
               class="audio-player"
               src="{{audioSrc}}"
               controls
               wx:if="{{audioSrc && !audioError}}">
        </audio>
        <view class="media-placeholder" wx:else>
          <view class="media-icon">🎵</view>
          <button class="play-btn" bindtap="playAudio" wx:if="{{!audioError}}">
            点击播放音频
          </button>
          <text class="error-text" wx:else>音频加载失败</text>
        </view>
      </view>
    </view>

    <!-- 提醒设置按钮 -->
    <view class="reminder-section">
      <button class="reminder-btn" bindtap="goToReminder">
        <text class="reminder-icon">⏰</text>
        <text>设置提醒</text>
      </button>
    </view>
  </view>
</view>

