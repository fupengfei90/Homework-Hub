# 🤖 AI智能识别功能说明

## 功能概述

AI智能识别功能使用大模型API，自动解析粘贴的作业内容，智能识别：
- ✅ **学科类型**：自动识别作业属于哪个学科
- ✅ **作业标题**：自动提取或生成作业标题
- ✅ **作业内容**：智能整理作业内容描述
- ✅ **视频链接**：自动识别并提取视频链接
- ✅ **音频链接**：自动识别并提取音频链接

## 使用方式

### 第一步：打开AI智能识别
1. 进入"发布作业"页面
2. 点击顶部的"🤖 AI智能识别"区域
3. 展开识别面板

### 第二步：粘贴内容
1. 从微信群复制作业内容
2. 点击"粘贴"按钮或直接输入
3. 内容会自动填入识别框

### 第三步：开始识别
1. 点击"开始识别"按钮
2. 等待AI分析（通常2-5秒）
3. 系统自动填充表单：
   - 作业标题
   - 学科类型
   - 作业内容
   - 视频/音频链接

### 第四步：确认并发布
1. 检查自动填充的内容
2. 可以手动调整不准确的部分
3. 点击"发布作业"

## 示例

### 输入内容
```
语文作业：背诵《静夜思》

请同学们背诵李白的《静夜思》，并理解诗歌的意境。
视频讲解：https://v.qq.com/x/page/example1.html
音频朗读：https://music.163.com/song?id=example1
```

### AI识别结果
- **学科**：语文
- **标题**：语文作业：背诵《静夜思》
- **内容**：请同学们背诵李白的《静夜思》，并理解诗歌的意境。
- **视频链接**：https://v.qq.com/x/page/example1.html
- **音频链接**：https://music.163.com/song?id=example1

## 配置大模型API

### 方案一：通义千问（推荐）

**优点**：
- 国内访问速度快
- 价格便宜
- 新用户有免费额度

**配置步骤**：
1. 访问：https://dashscope.console.aliyun.com/
2. 注册/登录阿里云账号
3. 开通通义千问服务
4. 创建API密钥
5. 在云函数环境变量中配置：
   ```
   AI_PROVIDER = qwen
   DASHSCOPE_API_KEY = 你的API密钥
   ```

### 方案二：OpenAI

**优点**：
- 识别准确度高
- 支持多种语言

**配置步骤**：
1. 访问：https://platform.openai.com/
2. 注册/登录账号
3. 创建API密钥
4. 在云函数环境变量中配置：
   ```
   AI_PROVIDER = openai
   OPENAI_API_KEY = 你的API密钥
   ```

### 方案三：本地规则匹配（无需配置）

如果未配置AI API，系统会自动使用规则匹配：
- 通过关键词识别学科
- 通过正则表达式提取链接
- 提取第一行作为标题

## 部署步骤

### 1. 安装依赖
```bash
cd cloudfunctions/aiParse
npm install
```

### 2. 配置环境变量
在微信开发者工具的云开发控制台：
1. 云函数 → aiParse → 配置 → 环境变量
2. 添加API密钥（见上方配置步骤）

### 3. 部署云函数
1. 右键点击 `cloudfunctions/aiParse`
2. 选择"上传并部署：云端安装依赖"
3. 等待部署完成

## 技术实现

### 架构设计
```
小程序前端
    ↓
云函数 aiParse
    ↓
大模型API（通义千问/OpenAI）
    ↓
返回结构化数据
    ↓
自动填充表单
```

### 备选方案
如果AI API调用失败，自动降级到规则匹配：
- 关键词匹配学科
- 正则表达式提取链接
- 第一行作为标题

## 费用说明

### 通义千问
- 按调用次数和token数计费
- 新用户免费额度：1000次调用
- 价格：约0.008元/1000 tokens
- 详情：https://help.aliyun.com/zh/model-studio/

### OpenAI
- 按token数计费
- GPT-3.5-turbo：约$0.002/1000 tokens
- 详情：https://openai.com/pricing

## 注意事项

1. **API密钥安全**：密钥存储在云函数环境变量中，不会暴露给前端
2. **调用频率**：注意API的调用频率限制
3. **成本控制**：建议设置API调用限制，避免产生意外费用
4. **识别准确度**：AI识别可能存在误差，建议人工确认
5. **网络要求**：需要稳定的网络连接

## 故障排查

### 问题：提示"未配置API密钥"
**解决**：
1. 检查云函数环境变量是否正确配置
2. 确认环境变量名称正确（DASHSCOPE_API_KEY 或 OPENAI_API_KEY）
3. 重新部署云函数

### 问题：API调用失败
**解决**：
1. 检查API密钥是否有效
2. 检查网络连接
3. 查看云函数日志
4. 系统会自动降级到规则匹配

### 问题：识别结果不准确
**解决**：
1. 确保输入内容完整清晰
2. 可以手动调整识别结果
3. 规则匹配作为备选方案

## 未来优化

- [ ] 支持更多大模型（文心一言、Claude等）
- [ ] 支持批量识别
- [ ] 识别准确度优化
- [ ] 支持图片识别（OCR）
- [ ] 支持语音识别

## 使用建议

1. **内容完整**：粘贴完整的作业内容，包含标题、学科、链接等信息
2. **格式清晰**：保持内容格式清晰，便于AI识别
3. **人工确认**：识别后建议人工确认，确保准确性
4. **成本控制**：合理使用，避免频繁调用产生高额费用

现在你可以直接粘贴微信群中的作业内容，AI会自动识别并填充表单！🎉

